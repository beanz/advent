#!/bin/sh
exec \
  perl -0ne 's/\n/ /g;$o=$s=$_;s/(\d+) /$s.="!".(substr$_,(pos)+length$1);$1." "/ge;$_=$s;s/! \d+ !/!/;s/(\d+) ([^!]*) !/$f=$1;$a=$2;$a=~s!(\d+)!"$f+$1=".($f+$1).">".($f*$1)!eg;$a/ge;$s=$_;m/=2020>(\d+)/ and print "Part 1: $1\n";s/([+\d]+=(?:3\d{3}|2[1-9]\d{2}|20[2-9]\d)>\d+ )//g;$n=$_; $_=$o;s!(\d+) !$v=$1;$n=~s/([+\d]+)=(\d+)>(\d+) \K/$f.="$v+$1=".($2+$v).">".($3*$v)." ";""/ge;"$v "!ge;$f=~m/=2020>(\d+)/ and print "Part 2: $1\n";'

